workflows:
  # ============================================
  # ğŸ¤– WORKFLOW ANDROID - Build Automatizado âœ… ACTIVO
  # ============================================
  android-workflow:
    name: ğŸ¤– Android Build & Deploy
    max_build_duration: 60
    instance_type: linux
    
    # Trigger automÃ¡tico en push a main
    triggering:
      events:
        - push
      branch_patterns:
        - pattern: 'main'
          include: true
          source: true
      tag_patterns:
        - pattern: 'v*'
          include: true
    
    environment:
      vars:
        PACKAGE_NAME: "sutodero.app"
      
      flutter: 3.24.0
      java: 17
    
    scripts:
      - name: ğŸ” Verificar entorno
        script: |
          echo "Flutter version:"
          flutter --version
          echo "Java version:"
          java -version
      
      - name: ğŸ“¦ Instalar dependencias Flutter
        script: |
          flutter clean
          flutter pub get
      
      - name: ğŸ” AnÃ¡lisis estÃ¡tico de cÃ³digo
        script: |
          flutter analyze || true  # No fallar el build por warnings
      
      - name: ğŸ—ï¸ Build APK Release
        script: |
          flutter build apk --release \
            --build-name=1.0.0 \
            --build-number=$BUILD_NUMBER \
            --target-platform android-arm,android-arm64,android-x64 \
            --split-per-abi
      
      - name: ğŸ—ï¸ Build App Bundle (AAB) para Play Store
        script: |
          flutter build appbundle --release \
            --build-name=1.0.0 \
            --build-number=$BUILD_NUMBER
      
      - name: ğŸ“‹ InformaciÃ³n del build
        script: |
          echo "âœ… Build completado exitosamente!"
          echo "ğŸ“¦ APKs generados:"
          ls -lh build/app/outputs/flutter-apk/*.apk
          echo "ğŸ“¦ App Bundle:"
          ls -lh build/app/outputs/bundle/release/*.aab
    
    artifacts:
      - build/app/outputs/flutter-apk/*.apk
      - build/app/outputs/bundle/release/*.aab
      - build/app/outputs/mapping/release/mapping.txt
    
    publishing:
      email:
        recipients:
          - mauricioc21@gmail.com
          - info@c21sutodero.com
        notify:
          success: true
          failure: true
      
      # Google Play - DistribuciÃ³n automÃ¡tica (descomentado cuando estÃ© listo)
      # google_play:
      #   credentials: $GCLOUD_SERVICE_ACCOUNT_CREDENTIALS
      #   track: internal  # internal, alpha, beta, production
      #   in_app_update_priority: 5

  # ============================================
  # ğŸŒ WORKFLOW WEB - Build Automatizado âœ… ACTIVO
  # ============================================
  web-workflow:
    name: ğŸŒ Web Build & Deploy
    max_build_duration: 30
    instance_type: linux_x2
    
    triggering:
      events:
        - push
      branch_patterns:
        - pattern: 'main'
          include: true
          source: true
    
    environment:
      flutter: 3.24.0
    
    scripts:
      - name: ğŸ“¦ Instalar dependencias
        script: |
          flutter clean
          flutter pub get
      
      - name: ğŸ—ï¸ Build Web
        script: |
          flutter build web --release \
            --web-renderer canvaskit \
            --base-href /sutodero/
      
      - name: ğŸ“‹ InformaciÃ³n del build
        script: |
          echo "âœ… Web build completado!"
          echo "ğŸ“¦ Archivos generados en: build/web/"
          du -sh build/web/
    
    artifacts:
      - build/web/**
    
    publishing:
      email:
        recipients:
          - mauricioc21@gmail.com
        notify:
          success: true
          failure: true

  # ============================================
  # ğŸ WORKFLOW iOS - DESACTIVADO â¸ï¸
  # ============================================
  # 
  # âš ï¸ REQUIERE: Apple Developer Account ($99/aÃ±o)
  # 
  # Para activar este workflow cuando estÃ©s listo:
  # 1. InscrÃ­bete en: https://developer.apple.com/programs/enroll/
  # 2. ObtÃ©n tu Team ID
  # 3. Crea App Store Connect API Key
  # 4. Configura credenciales en Codemagic
  # 5. Actualiza ios/ExportOptions.plist con tu Team ID
  # 6. Descomenta todo el cÃ³digo de abajo
  # 7. Haz push a GitHub
  # 
  # DocumentaciÃ³n completa en: CONFIGURACION_CICD_AUTOMATICO.md
  #
  # ios-workflow:
  #   name: ğŸ iOS Build & Deploy
  #   max_build_duration: 60
  #   instance_type: mac_mini_m1
  #   triggering:
  #     events:
  #       - push
  #     branch_patterns:
  #       - pattern: 'main'
  #         include: true
  #   environment:
  #     groups:
  #       - app_store_credentials
  #     vars:
  #       XCODE_WORKSPACE: "ios/Runner.xcworkspace"
  #       BUNDLE_ID: "sutodero.app"
  #     flutter: 3.24.0
  #     xcode: 15.0
  #   scripts:
  #     - name: ğŸ“¦ Instalar dependencias
  #       script: flutter pub get
  #     - name: ğŸ CocoaPods
  #       script: cd ios && pod install && cd ..
  #     - name: ğŸ—ï¸ Build IPA
  #       script: flutter build ipa --release
  #   artifacts:
  #     - build/ios/ipa/*.ipa
  #   publishing:
  #     email:
  #       recipients:
  #         - mauricioc21@gmail.com
  #       notify:
  #         success: true
  #     app_store_connect:
  #       submit_to_testflight: true
